---
layout: post
title:  "谈谈 ssh 的那些事儿"
date:   2024-10-03
category: networking
tags:   ssh
---

最近看到一篇文章[那些 ssh 教我的事](https://yangwenbo.com/articles/ssh-oh-my-god.html)，虽然是 2009 年发布的，虽然我也用了 ssh 很多年，但这些事儿我还真不知道，比如 ssh -L 和 ssh -R 这两个选项的作用，即使 sftp 知道也用过，但是没有具体去研究原理，所以借着国庆休假的时间，谈谈 ssh 的那些事儿。

ssh 最广为人知的用处就是远程登录了，它比 telnet 更安全，因此现在绝大部分网络设备和服务器都支持 ssh 服务器，允许通过 ssh 客户端登录管理。我们使用这种方式登录服务器的时候，一般都会看到一些提示窗口，询问我们是否保存服务器密钥指纹(key fingerprint)，确认之后我们才能够使用用户名和密码登录服务器。[什么是SSH？](https://info.support.huawei.com/info-finder/encyclopedia/zh/SSH.html)这篇文章详细介绍了 ssh 的工作原理，这里就不再一一赘述了，需要注意的几点是：
1. 算法协商阶段涉及各种类型的算法，如果存在客户端和服务器对某个类型的算法达不成一致。则无法建立回话，这也是某些登录失败的原因。
2. 密钥交换过程中涉及对称加密和非对称加密，其中对称加密密钥用于后续的数据传输，而非对称加密用于回话建立阶段报文的交互。对称加密的密钥不是通过回话传输的，而是客户端和服务器分别计算出来的，这在数学上是可以保证二者是一样的。这样的好处是非对称密钥和对称密钥的私钥都不经过传输，保证了通信的安全。
2. 用户认证除了密码认证，还有密钥认证方式。因为平时主要用密码认证，对于密钥认证不是很了解，其实这是一种很重要的方式，因为密码认证虽然方便，但存在被暴力破解的可能。下面还会介绍一种证书登录方式，其实有些类似于 https 证书认证流程了。

[SSH 证书登录教程](https://www.ruanyifeng.com/blog/2020/07/ssh-certificate.html)这篇文章介绍了如何配置证书登录方式。